(function(t){function e(e){for(var c,r,u=e[0],i=e[1],s=e[2],l=0,p=[];l<u.length;l++)r=u[l],Object.prototype.hasOwnProperty.call(o,r)&&o[r]&&p.push(o[r][0]),o[r]=0;for(c in i)Object.prototype.hasOwnProperty.call(i,c)&&(t[c]=i[c]);b&&b(e);while(p.length)p.shift()();return a.push.apply(a,s||[]),n()}function n(){for(var t,e=0;e<a.length;e++){for(var n=a[e],c=!0,r=1;r<n.length;r++){var i=n[r];0!==o[i]&&(c=!1)}c&&(a.splice(e--,1),t=u(u.s=n[0]))}return t}var c={},o={app:0},a=[];function r(t){return u.p+"js/"+({}[t]||t)+"."+{"chunk-2d0c9189":"c81458cc","chunk-2d0cf391":"020c75ea","chunk-2d0da8f3":"c8c3e7e8","chunk-2d2248b6":"d84473c1","chunk-2d22523a":"4b710d99"}[t]+".js"}function u(e){if(c[e])return c[e].exports;var n=c[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,u),n.l=!0,n.exports}u.e=function(t){var e=[],n=o[t];if(0!==n)if(n)e.push(n[2]);else{var c=new Promise((function(e,c){n=o[t]=[e,c]}));e.push(n[2]=c);var a,i=document.createElement("script");i.charset="utf-8",i.timeout=120,u.nc&&i.setAttribute("nonce",u.nc),i.src=r(t);var s=new Error;a=function(e){i.onerror=i.onload=null,clearTimeout(l);var n=o[t];if(0!==n){if(n){var c=e&&("load"===e.type?"missing":e.type),a=e&&e.target&&e.target.src;s.message="Loading chunk "+t+" failed.\n("+c+": "+a+")",s.name="ChunkLoadError",s.type=c,s.request=a,n[1](s)}o[t]=void 0}};var l=setTimeout((function(){a({type:"timeout",target:i})}),12e4);i.onerror=i.onload=a,document.head.appendChild(i)}return Promise.all(e)},u.m=t,u.c=c,u.d=function(t,e,n){u.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},u.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},u.t=function(t,e){if(1&e&&(t=u(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(u.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var c in t)u.d(n,c,function(e){return t[e]}.bind(null,c));return n},u.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return u.d(e,"a",e),e},u.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},u.p="/DynamicBusRoute/",u.oe=function(t){throw console.error(t),t};var i=window["webpackJsonp"]=window["webpackJsonp"]||[],s=i.push.bind(i);i.push=e,i=i.slice();for(var l=0;l<i.length;l++)e(i[l]);var b=s;a.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"04b2":function(t,e,n){"use strict";n("cb3a")},1:function(t,e){},2918:function(t,e,n){},3265:function(t,e,n){"use strict";n("e00c")},4724:function(t,e,n){},"529e":function(t,e,n){"use strict";n("6800")},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d"),n("b107");var c=n("7b17"),o=(n("6cc5"),n("ecee")),a=n("c074"),r=n("b702"),u=n("ad3d"),i=n("7a23"),s=n("9b19"),l=n.n(s),b={class:"position-fixed top-0 bg-white w-100 p-4 pb-3 shadow"},p=Object(i["g"])("img",{src:l.a,alt:"",srcset:""},null,-1),f={class:"small mt-2 text-success d-flex align-items-center"},O=Object(i["g"])("span",{class:"mx-auto"},"全台公車時刻資訊整合網",-1),j=Object(i["g"])("footer",{class:"position-fixed bottom-0 w-100 bg-white text-success shadow py-3"}," Designed By Len Cheng && Celeste ",-1);function d(t,e,n,c,o,a){var r=Object(i["C"])("font-awesome-icon"),u=Object(i["C"])("Menu"),s=Object(i["C"])("router-view");return Object(i["u"])(),Object(i["f"])(i["a"],null,[Object(i["g"])("header",b,[p,Object(i["g"])("section",f,[Object(i["L"])(Object(i["i"])(r,{icon:["fas","reply"],class:"fs-4",onPointerup:Object(i["M"])(c.backToLast,["prevent","stop"])},null,8,["onPointerup"]),[[i["I"],"/"!==t.$route.path]]),O,Object(i["L"])(Object(i["i"])(r,{icon:["fas","bars"],class:"fs-4","data-bs-toggle":"offcanvas",href:"#menu",role:"button","aria-controls":"offcanvasExample"},null,512),[[i["I"],"/"!==t.$route.path]])])]),Object(i["i"])(u),Object(i["i"])(s,{style:{"padding-top":"120px"}}),j],64)}var m=n("6c02"),g={class:"offcanvas offcanvas-end",tabindex:"-1",id:"menu",ref:"menu","aria-labelledby":"offcanvasExampleLabel"},h=Object(i["g"])("div",{class:"offcanvas-header"},[Object(i["g"])("button",{type:"button",class:"btn-close bg-primary ms-auto","data-bs-dismiss":"offcanvas","aria-label":"Close"})],-1),y=Object(i["g"])("img",{src:l.a,alt:"",srcset:""},null,-1),v=Object(i["g"])("p",{class:"fs-xs my-2"},"全台公車時刻資訊整合網",-1),S=Object(i["g"])("div",{class:"h5"},"公車查詢",-1),w=Object(i["g"])("small",{class:"text-success"},"查詢指定公車路線及其停靠站",-1),x=Object(i["g"])("div",{class:"h5"},"附近公車",-1),R=Object(i["g"])("small",{class:"text-success"},"查詢附近公車站及其路線",-1),D=Object(i["g"])("div",{class:"h5"},"我的收藏",-1),I=Object(i["g"])("small",{class:"text-success"},"收藏的公車站及路線",-1),N=Object(i["g"])("footer",{class:"position-fixed bottom-0 py-3"},"Designed By Len Cheng && Celeste",-1);function k(t,e,n,c,o,a){var r=Object(i["C"])("router-link");return Object(i["u"])(),Object(i["f"])("aside",g,[h,Object(i["g"])("div",{class:"offcanvas-body d-flex flex-column align-items-center d-grid gap-5",onPointerup:e[0]||(e[0]=function(){return c.closeMenu&&c.closeMenu.apply(c,arguments)})},[Object(i["i"])(r,{to:"/",class:"btn"},{default:Object(i["K"])((function(){return[y,v]})),_:1}),Object(i["i"])(r,{to:"/bus",class:"btn"},{default:Object(i["K"])((function(){return[S,w]})),_:1}),Object(i["i"])(r,{to:"/NearBus",class:"btn"},{default:Object(i["K"])((function(){return[x,R]})),_:1}),Object(i["i"])(r,{to:"/collect/station",class:"btn"},{default:Object(i["K"])((function(){return[D,I]})),_:1}),N],32)],512)}var C={name:"Menu",setup:function(){var t=Object(i["z"])(null),e="";Object(i["J"])(t,(function(t,n){t&&t!==n&&(e=new c["Offcanvas"](t))}));var n=function(){e.hide()};return{menu:t,closeMenu:n}}},B=n("6b0d"),U=n.n(B);const E=U()(C,[["render",k]]);var _=E,M={name:"App",components:{Menu:_},setup:function(){var t=Object(m["c"])(),e=function(){t.go(-1)};return{backToLast:e}}};n("04b2");const T=U()(M,[["render",d]]);var P=T,L={class:"home container"},Z={class:"d-grid gap-3 my-4"},J=Object(i["g"])("div",{class:"h5"},"公車查詢",-1),$=Object(i["g"])("small",{class:"text-success"},"查詢指定公車路線及其停靠站",-1),K=Object(i["g"])("div",{class:"h5"},"附近公車",-1),z=Object(i["g"])("small",{class:"text-success"},"查詢附近公車站及其路線",-1),q=Object(i["g"])("div",{class:"h5"},"我的收藏",-1),F=Object(i["g"])("small",{class:"text-success"},"收藏的公車站及路線",-1),A={style:{"padding-bottom":"80px"}},G={key:0,class:"d-flex flex-column justify-content-center align-items-center",style:{height:"25vh"}},H=Object(i["g"])("div",{class:"small mb-1"},"開啟定位服務，以獲得更多資訊",-1),X={key:1,class:"bg-white p-3 rounded-3 shadow"},W=Object(i["g"])("div",{class:"text-start"},"附近公車",-1),V={key:0,class:"table table-borderless align-middle my-2"},Y={class:"text-start"},Q={class:"fw-bold"},tt={class:"text-success fs-xs"},et={class:"text-start"},nt={class:"fw-bold"},ct={class:"text-success fs-xs"},ot={class:"text-end"},at={key:1},rt=Object(i["h"])("查詢其他公車路線");function ut(t,e,n,c,o,a){var r=Object(i["C"])("router-link");return Object(i["u"])(),Object(i["f"])("article",L,[Object(i["g"])("div",Z,[Object(i["i"])(r,{to:"/bus",class:"btn py-3 bg-white rounded-3 shadow"},{default:Object(i["K"])((function(){return[J,$]})),_:1}),Object(i["i"])(r,{to:"/NearBus",class:"btn py-3 bg-white rounded-3 shadow"},{default:Object(i["K"])((function(){return[K,z]})),_:1}),Object(i["i"])(r,{to:"/collect/station",class:"btn py-3 bg-white rounded-3 shadow"},{default:Object(i["K"])((function(){return[q,F]})),_:1})]),Object(i["g"])("div",A,[c.location?Object(i["e"])("",!0):(Object(i["u"])(),Object(i["f"])("div",G,[H,Object(i["g"])("button",{class:"btn btn-lg px-3 w-75 bg-white rounded-3 shadow",onPointerup:e[0]||(e[0]=Object(i["M"])((function(){return c.openGeolocation&&c.openGeolocation.apply(c,arguments)}),["prevent","stop"]))}," 開啟定位服務 ",32)])),c.location?(Object(i["u"])(),Object(i["f"])("div",X,[W,0!==c.homeNearLocationBus.length?(Object(i["u"])(),Object(i["f"])("table",V,[Object(i["g"])("tbody",null,[(Object(i["u"])(!0),Object(i["f"])(i["a"],null,Object(i["B"])(c.homeNearLocationBus,(function(t){return Object(i["u"])(),Object(i["f"])("tr",{key:t.StopUID},[Object(i["g"])("td",Y,[Object(i["g"])("h5",Q,Object(i["E"])(t.RouteName.Zh_tw),1),Object(i["g"])("div",tt,"往"+Object(i["E"])(t.DestinationStopNameZh),1)]),Object(i["g"])("td",et,[Object(i["g"])("h5",nt,Object(i["E"])(t.StopName.Zh_tw),1),Object(i["g"])("div",ct,Object(i["E"])(t.distance)+"公尺",1)]),Object(i["g"])("td",ot,Object(i["E"])(t.EstimateTime),1)])})),128))])])):(Object(i["u"])(),Object(i["f"])("p",at,"1 公里內查無公車")),Object(i["i"])(r,{to:"/NearBus",class:"btn text-success"},{default:Object(i["K"])((function(){return[rt]})),_:1})])):Object(i["e"])("",!0)])])}var it=n("5530"),st=n("2909"),lt=n("3835"),bt=(n("fb6a"),n("d3b7"),n("159b"),n("3ca3"),n("ddb0"),n("99af"),n("5502")),pt=n("1da1"),ft=(n("96cf"),n("4de4"),n("ac1f"),n("5319"),n("caad"),n("2532"),n("1abe")),Ot=n.n(ft),jt=n("1132"),dt=n.n(jt),mt=n("8d88");n("5b81");function gt(t){var e=/\(/gi,n=/\)/gi,c=t.indexOf("("),o=t.substring(c);return o=o.replace(e,"[["),o=o.replace(n,"]]"),o=o.replaceAll(/(,)\s|(,)/g,"],["),o=o.replaceAll(" ",","),o=JSON.parse(o),o.forEach((function(t){t.reverse()})),{type:"LineString",coordinates:o}}var ht=Object(bt["a"])({state:{api:{Shape_url:"https://ptx.transportdata.tw/MOTC/v2/Bus/Shape/City/",Route_url:"https://ptx.transportdata.tw/MOTC/v2/Bus/Route/City/",Estimated_url:"https://ptx.transportdata.tw/MOTC/v2/Bus/EstimatedTimeOfArrival/City/",RealTimeByFrequency_url:"https://ptx.transportdata.tw/MOTC/v2/Bus/RealTimeByFrequency/City/",RealTimeNearStop_url:"https://ptx.transportdata.tw/MOTC/v2/Bus/RealTimeNearStop/City/",StopOfRoute_url:"https://ptx.transportdata.tw/MOTC/v2/Bus/StopOfRoute/City/",Station_url:"https://ptx.transportdata.tw/MOTC/v2/Bus/Station/City/",nominatim_url:"https://nominatim.openstreetmap.org/reverse?format=json&",id:"0c672be3679e4f1e8441118a50a5d9f3",key:"ovFaA4lsqC5GyOKZHEEo_IS1Vt4"},city:{Taipei:"臺北市",NewTaipei:"新北市",Taoyuan:"桃園市",Taichung:"臺中市",Tainan:"臺南市",Kaohsiung:"高雄市",Keelung:"基隆市",Hsinchu:"新竹市",HsinchuCounty:"新竹縣",MiaoliCounty:"苗栗縣",ChanghuaCounty:"彰化縣",NantouCounty:"南投縣",YunlinCounty:"雲林縣",ChiayiCounty:"嘉義縣",Chiayi:"嘉義市",PingtungCounty:"屏東縣",YilanCounty:"宜蘭縣",HualienCounty:"花蓮縣",TaitungCounty:"臺東縣",KinmenCounty:"金門縣",PenghuCounty:"澎湖縣",LienchiangCounty:"連江縣"},routes:[{RouteUID:"",RouteName:{Zh_tw:""}}],selectedRoute:{shape:{Geometry:{type:"",coordinates:[]}},Stops:[{StopID:"",StopPosition:{PositionLat:"",PositionLon:""}}],Estimated:[],RealTimeByFrequency:[],RealTimeNearStop:[]},location:{lat:"",lon:"",city:""},NearLocationBus:[]},getters:{headers:function(t){var e=t.api,n=e.key,c=e.id,o=(new Date).toUTCString(),a=Ot()("x-date: ".concat(o),n),r=dt.a.stringify(a);return{methods:"GET",headers:{Authorization:'hmac username="'.concat(c,'", algorithm="hmac-sha1", headers="x-date", signature="').concat(r,'"'),"x-date":o}}},filterRoute:function(t){return function(e){var n=t.routes.filter((function(t){return t.RouteUID===e}));return n}},filterStopRoute:function(t){return function(e){if(0!==t.selectedRoute.Stops.length){var n=t.selectedRoute.Stops.filter((function(t){return t.Direction===e}));return n}return[]}},filterRealTimeNearStop:function(t){return function(e){var n=t.selectedRoute.RealTimeNearStop;if(0!==n.length){var c=n.filter((function(t){return t.Direction===e}));return c}return[]}},filterRealTimeByFrequency:function(t){return function(e){var n=t.selectedRoute.RealTimeByFrequency;if(0!==n.length){var c=n.filter((function(t){return t.Direction===e}));return c}return[]}},filterEstimatedBus:function(t){return function(e){if(0!==t.selectedRoute.Estimated.length){var n=t.selectedRoute.Estimated.reduce((function(t,e){return t.some((function(t){return t.StopUID===e.StopUID&&t.Direction===e.Direction}))?t:[].concat(Object(st["a"])(t),[e])}),[]),c=n.filter((function(t){return t.Direction===e}));return c}return[]}},filterNearLocationBus:function(t){var e=t.location,n=e.lat,c=e.lon,o=t.NearLocationBus.reduce((function(t,e){var o=t;return e.Stops.forEach((function(a){if(!t.some((function(t){return t.StopUID===a.StopUID}))){var r=e.StationPosition,u=r.PositionLon,i=r.PositionLat,s=Math.ceil(1e3*Object(mt["a"])(c,n,u,i));o=[].concat(Object(st["a"])(t),[Object(it["a"])(Object(it["a"])({},a),{},{distance:s})])}})),o}),[]);return o}},mutations:{getRouteData:function(t,e){var n=JSON.parse(localStorage.getItem("collectRoute"))||[];e.forEach((function(t){var e=t;n.some((function(e){return e.RouteUID===t.RouteUID}))?e.isCollect=!0:e.isCollect=!1})),t.routes=e},getShapeData:function(t,e){var n=e;n.Geometry=gt(n.Geometry),t.selectedRoute.shape=n},getStopData:function(t,e){e.forEach((function(t){t.Stops.forEach((function(t){var e=t,n=JSON.parse(localStorage.getItem("collectStation"))||[];n.some((function(e){return e.stop.StopUID===t.StopUID}))?e.isCollect=!0:e.isCollect=!1}))})),t.selectedRoute.Stops=e},getRealTimeByFrequencyData:function(t,e){t.selectedRoute.RealTimeByFrequency=e},getRealTimeNearStopData:function(t,e){t.selectedRoute.RealTimeNearStop=e},getEstimatedData:function(t,e){t.selectedRoute.Estimated=e},clearDataNearLocation:function(t){t.NearLocationBus=[]},getDataNearLocation:function(t,e){t.NearLocationBus=e},getLocation:function(t,e){t.location=e}},actions:{getData:function(t,e){return Object(pt["a"])(regeneratorRuntime.mark((function n(){var c,o,a,r,u,i,s,l,b,p,f,O,j,d,m,g;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:c=t.state,o=t.getters,a=t.commit,r=c.api,u=r.Shape_url,i=r.Route_url,s=r.StopOfRoute_url,l=r.RealTimeNearStop_url,b=r.RealTimeByFrequency_url,p=r.Estimated_url,f=e.type,O=e.routeName,j=e.city,d=e.routeId,n.t0=f,n.next="route"===n.t0?6:"estimated"===n.t0?15:"shape"===n.t0?24:"stop"===n.t0?33:"realTimeNearStop"===n.t0?42:"realTimeByFrequency"===n.t0?51:60;break;case 6:return n.next=8,fetch("".concat(i).concat(j,"/").concat(O,"?$format=JSON"),o.headers);case 8:if(m=n.sent,!m.ok){n.next=14;break}return n.next=12,m.json();case 12:g=n.sent,a("getRouteData",g);case 14:return n.abrupt("break",61);case 15:return n.next=17,fetch("".concat(p).concat(j,"/").concat(O,"?$filter=RouteUID eq '").concat(d,"'&$orderBy=StopSequence&$format=JSON"),o.headers);case 17:if(m=n.sent,!m.ok){n.next=23;break}return n.next=21,m.json();case 21:g=n.sent,a("getEstimatedData",g);case 23:return n.abrupt("break",61);case 24:return n.next=26,fetch("".concat(u).concat(j,"/").concat(O,"?$filter=RouteUID eq '").concat(d,"'&$format=JSON"),o.headers);case 26:if(m=n.sent,!m.ok){n.next=32;break}return n.next=30,m.json();case 30:g=n.sent,a("getShapeData",g[0]);case 32:return n.abrupt("break",61);case 33:return n.next=35,fetch("".concat(s).concat(j,"/").concat(O,"?$filter=RouteUID eq '").concat(d,"'&$format=JSON"),o.headers);case 35:if(m=n.sent,!m.ok){n.next=41;break}return n.next=39,m.json();case 39:g=n.sent,a("getStopData",g);case 41:return n.abrupt("break",61);case 42:return n.next=44,fetch("".concat(l).concat(j,"/").concat(O,"?$filter=RouteUID eq '").concat(d,"'&$format=JSON"),o.headers);case 44:if(m=n.sent,!m.ok){n.next=50;break}return n.next=48,m.json();case 48:g=n.sent,a("getRealTimeNearStopData",g);case 50:return n.abrupt("break",61);case 51:return n.next=53,fetch("".concat(b).concat(j,"/").concat(O,"?$filter=RouteUID eq '").concat(d,"'&$top=10&$format=JSON"),o.headers);case 53:if(m=n.sent,!m.ok){n.next=59;break}return n.next=57,m.json();case 57:g=n.sent,a("getRealTimeByFrequencyData",g);case 59:return n.abrupt("break",61);case 60:return n.abrupt("break",61);case 61:case"end":return n.stop()}}),n)})))()},getDataNearLocation:function(t,e){return Object(pt["a"])(regeneratorRuntime.mark((function n(){var c,o,a,r,u,i,s,l,b,p,f,O,j,d,m;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return c=t.state,o=t.getters,a=t.commit,a("clearDataNearLocation"),r=e.lat,u=e.lon,i=e.DistanceInMeters,s=c.api,l=s.nominatim_url,b=s.Station_url,n.next=6,fetch("".concat(l,"lat=").concat(r,"&lon=").concat(u,"&accept-language=en"));case 6:return p=n.sent,n.next=9,p.json();case 9:if(f=n.sent,O=f.address.county.replace(" ","")||f.address.city.replace(" ",""),a("getLocation",{lat:r,lon:u,city:O}),O.includes("Keelung")||O.includes("Lienchiang")){n.next=20;break}return n.next=15,fetch("".concat(b).concat(O,"?$spatialFilter=nearby(").concat(r,", ").concat(u,", ").concat(i,")&$format=JSON"),o.headers);case 15:return j=n.sent,n.next=18,j.json();case 18:d=n.sent,j.ok&&0!==d.length&&(m=d.reduce((function(t,e){return t.some((function(t){return t.StationGroupID===e.StationGroupID}))?t:[].concat(Object(st["a"])(t),[e])}),[]),a("getDataNearLocation",m));case 20:case"end":return n.stop()}}),n)})))()},getDestinationStop:function(t,e){return Object(pt["a"])(regeneratorRuntime.mark((function n(){var c,o,a,r,u,i,s,l,b,p,f,O;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:c=t.state,o=t.getters,a=c.api,r=a.Route_url,u=a.Estimated_url,i=e.city,s=e.RouteName,l=e.RouteUID,b=e.type,p=e.StopUID,n.t0=b,n.next="route"===n.t0?6:"estimated"===n.t0?10:14;break;case 6:return n.next=8,fetch("".concat(r).concat(i,"/").concat(s,"?$select=DestinationStopNameZh &$filter=RouteUID eq '").concat(l,"'&$format=JSON"),o.headers);case 8:return f=n.sent,n.abrupt("break",15);case 10:return n.next=12,fetch("".concat(u).concat(i,"/").concat(s,"?$filter=RouteUID eq '").concat(l,"' and StopUID eq '").concat(p,"' and StopStatus eq '正常'&$top=1&$format=JSON"),o.headers);case 12:return f=n.sent,n.abrupt("break",15);case 14:return n.abrupt("break",15);case 15:if(!f.ok){n.next=20;break}return n.next=18,f.json();case 18:return O=n.sent,n.abrupt("return",O);case 20:return n.abrupt("return",[]);case 21:case"end":return n.stop()}}),n)})))()}},modules:{}});function yt(t){if(navigator.geolocation){var e={enableHighAccuracy:!0,timeout:5e3,maximumAge:0},n=function(e){var n=e.coords;console.log(n);var c=n.latitude,o=n.longitude;ht.dispatch("getDataNearLocation",{lat:c,lon:o,DistanceInMeters:t})};navigator.geolocation.getCurrentPosition(n,(function(t){console.log(t)}),e)}else alert("你的裝置或瀏覽器不支援定位功能")}var vt={name:"Home",components:{},setup:function(){var t=Object(bt["b"])(),e=t.state,n=t.getters,c=t.dispatch,o=Object(i["z"])(!1),a=Object(i["b"])((function(){return n.filterNearLocationBus.slice(0,4)})),r=Object(i["z"])([]),u=Object(i["b"])((function(){return e.location.city})),s=function(){o.value=!0,yt(1e3)};return Object(i["J"])(a,(function(t,e){0!==t.length&&t!==e&&t.forEach((function(t){var e=t,n=c("getDestinationStop",{type:"route",city:u.value,RouteName:e.RouteName.Zh_tw,RouteUID:e.RouteUID}),o=c("getDestinationStop",{type:"estimated",city:u.value,RouteName:e.RouteName.Zh_tw,RouteUID:e.RouteUID,StopUID:e.StopUID});Promise.all([n,o]).then((function(t){var n=Object(lt["a"])(t,2),c=n[0],o=n[1];console.log(c,o),r.value=[].concat(Object(st["a"])(r.value),[Object(it["a"])(Object(it["a"])({},e),{},{DestinationStopNameZh:c[0].DestinationStopNameZh,EstimateTime:o[0]?"".concat(Math.ceil(o[0].EstimateTime/60),"分"):"未提供"})])}))}))})),{location:o,openGeolocation:s,NearLocationBus:a,homeNearLocationBus:r}}};const St=U()(vt,[["render",ut]]);var wt=St,xt=function(t){return Object(i["x"])("data-v-0dc85124"),t=t(),Object(i["v"])(),t},Rt={class:"bus container",style:{"padding-top":"120px"}},Dt={class:"dropdown",ref:"dropdown"},It={class:"btn bg-white btn-lg rounded-3 w-100",type:"button","data-bs-toggle":"dropdown","data-bs-auto-close":"true","aria-expanded":"false"},Nt={class:"dropdown-menu rounded-3 shadow w-100 overflow-scroll"},kt=["data-city-en","data-city-zh"],Ct={class:"mt-4"},Bt=xt((function(){return Object(i["g"])("div",{class:"text-start"},"查詢歷史",-1)})),Ut={class:"position-fixed bottom-0 w-100 bg-white shadow fs-4",style:{"z-index":"1002"}},Et={class:"container d-flex flex-column align-items-center"},_t={key:0,class:"mt-4"},Mt={key:1,class:"d-flex justify-content-end alidn-items-center w-100 py-2"},Tt={class:"col"},Pt={class:"btn btn-lg btn-outline-primary"},Lt={class:"col"},Zt={class:"btn btn-lg btn-outline-primary"},Jt={class:"btn btn-lg btn-outline-primary"},$t={class:"col"},Kt={class:"btn btn-lg btn-outline-primary"},zt={class:"col"},qt={class:"btn btn-lg btn-outline-primary"},Ft={class:"btn btn-lg btn-outline-primary"},At={class:"col"},Gt={class:"btn btn-lg btn-outline-primary"},Ht={class:"col"},Xt={class:"btn btn-lg btn-outline-primary"},Wt={class:"btn btn-lg btn-outline-primary"},Vt={class:"col"},Yt={class:"col"},Qt=xt((function(){return Object(i["g"])("div",{class:"col"},[Object(i["g"])("button",{class:"btn btn-lg btn-outline-primary"},"0")],-1)})),te={class:"col"},ee={class:"col"};function ne(t,e,n,c,o,a){var r=Object(i["C"])("font-awesome-icon"),u=Object(i["C"])("BusRoute");return Object(i["u"])(),Object(i["f"])(i["a"],null,[Object(i["g"])("article",Rt,[Object(i["g"])("div",Dt,[Object(i["g"])("button",It,[Object(i["h"])(Object(i["E"])(t.cityZh?"".concat(t.cityZh.substring(0,2),"公車"):"選擇縣市")+" ",1),Object(i["i"])(r,{icon:["fas","chevron-down"],class:"fs-6 ms-3"})]),Object(i["g"])("ul",Nt,[Object(i["g"])("li",{class:"p-3 btn-lg position-absolute dropdown-menu-icon",onPointerup:e[0]||(e[0]=Object(i["M"])((function(){return c.closeDropMenu&&c.closeDropMenu.apply(c,arguments)}),["prevent","stop"]))},[Object(i["i"])(r,{icon:["fas","chevron-up"],onPointerup:Object(i["M"])(c.closeDropMenu,["stop"])},null,8,["onPointerup"])],32),(Object(i["u"])(!0),Object(i["f"])(i["a"],null,Object(i["B"])(c.BusCity,(function(t,n){return Object(i["u"])(),Object(i["f"])("li",{class:"text-center py-3 btn-lg",key:n,"data-city-en":n,"data-city-zh":t,onPointerup:e[1]||(e[1]=Object(i["M"])((function(){return c.getCityName&&c.getCityName.apply(c,arguments)}),["prevent","stop"]))},Object(i["E"])(t.substring(0,2))+"公車 ",41,kt)})),128))])],512),Object(i["g"])("section",Ct,[Bt,Object(i["i"])(u)])]),Object(i["L"])(Object(i["g"])("section",Ut,[Object(i["g"])("div",Et,[c.keyboard?(Object(i["u"])(),Object(i["f"])("p",_t,Object(i["E"])(t.routeName),1)):(Object(i["u"])(),Object(i["f"])("div",Mt,[Object(i["L"])(Object(i["g"])("input",{type:"text",ref:"routeNameInput","onUpdate:modelValue":e[2]||(e[2]=function(e){return t.routeName=e}),style:{"text-align":"center"},class:"form-control border-0 me-3 fs-3 lh-sm"},null,512),[[i["H"],t.routeName]]),Object(i["g"])("button",{class:"btn btn-lg btn-outline-primary fs-2",onPointerup:e[3]||(e[3]=Object(i["M"])((function(){return c.changeKeyboard&&c.changeKeyboard.apply(c,arguments)}),["prevent","stop"]))},[Object(i["i"])(r,{icon:["fas","globe"]})],32)])),c.keyboard?(Object(i["u"])(),Object(i["f"])("div",{key:2,class:"row gx-1 gy-2 btns-option mb-3",onPointerup:e[8]||(e[8]=Object(i["M"])((function(){return c.getRouteName&&c.getRouteName.apply(c,arguments)}),["stop"]))},[Object(i["g"])("div",Tt,[Object(i["g"])("button",Pt,Object(i["E"])(c.options?"紅":"內科"),1)]),Object(i["g"])("div",Lt,[Object(i["g"])("button",Zt,Object(i["E"])(c.options?"藍":"通勤"),1)]),(Object(i["u"])(),Object(i["f"])(i["a"],null,Object(i["B"])(3,(function(t){return Object(i["g"])("div",{class:"col",key:t},[Object(i["g"])("button",Jt,Object(i["E"])(t),1)])})),64)),Object(i["g"])("div",$t,[Object(i["g"])("button",Kt,Object(i["E"])(c.options?"綠":"南軟"),1)]),Object(i["g"])("div",zt,[Object(i["g"])("button",qt,Object(i["E"])(c.options?"棕":"小"),1)]),(Object(i["u"])(),Object(i["f"])(i["a"],null,Object(i["B"])(3,(function(t){return Object(i["g"])("div",{class:"col",key:t},[Object(i["g"])("button",Ft,Object(i["E"])(t+3),1)])})),64)),Object(i["g"])("div",At,[Object(i["g"])("button",Gt,Object(i["E"])(c.options?"橘":"市民"),1)]),Object(i["g"])("div",Ht,[Object(i["g"])("button",Xt,Object(i["E"])(c.options?"幹道":"F"),1)]),(Object(i["u"])(),Object(i["f"])(i["a"],null,Object(i["B"])(3,(function(t){return Object(i["g"])("div",{class:"col",key:t},[Object(i["g"])("button",Wt,Object(i["E"])(t+6),1)])})),64)),Object(i["g"])("div",Vt,[Object(i["g"])("button",{class:"btn btn-lg btn-outline-primary",onPointerup:e[4]||(e[4]=Object(i["M"])((function(){return c.changeKeyboard&&c.changeKeyboard.apply(c,arguments)}),["stop"]))},[Object(i["i"])(r,{icon:["fas","globe"]})],32)]),Object(i["g"])("div",Yt,[Object(i["g"])("button",{class:"btn btn-lg btn-outline-primary",onPointerup:e[5]||(e[5]=Object(i["M"])((function(){return c.changeOptions&&c.changeOptions.apply(c,arguments)}),["stop"]))},Object(i["E"])(c.options?"更多":"返回"),33)]),Qt,Object(i["g"])("div",te,[Object(i["g"])("button",{class:"btn btn-lg btn-outline-primary","data-clear":"all",onPointerup:e[6]||(e[6]=Object(i["M"])((function(){return c.deleteWord&&c.deleteWord.apply(c,arguments)}),["stop"]))}," 重設 ",32)]),Object(i["g"])("div",ee,[Object(i["g"])("button",{class:"btn btn-lg btn-outline-primary","data-clear":"1",onPointerup:e[7]||(e[7]=Object(i["M"])((function(){return c.deleteWord&&c.deleteWord.apply(c,arguments)}),["stop"]))},[Object(i["i"])(r,{icon:["fas","backspace"]})],32)])],32)):Object(i["e"])("",!0)])],512),[[i["I"],c.customKeyboard]])],64)}n("b0c0");var ce={key:0,class:"container"},oe=["onPointermove","onPointerup"],ae={class:"col-auto"},re={class:"col text-center"},ue=["onPointerup"],ie={key:1,class:"p-0 text-nowrap col-auto"},se=["onPointerup"];function le(t,e,n,c,o,a){var r=Object(i["C"])("font-awesome-icon");return 0!==c.routes.length&&c.routes[0].RouteUID?(Object(i["u"])(),Object(i["f"])("div",ce,[(Object(i["u"])(!0),Object(i["f"])(i["a"],null,Object(i["B"])(c.routes,(function(e){return Object(i["u"])(),Object(i["f"])("div",{key:e.RouteUID,class:Object(i["o"])(["row gx-2 justify-content-between  align-items-center my-3 bg-white py-2 px-1  rounded-3",c.deleteBtnIsShow===e.RouteUID?"moveRight":""]),onPointermove:Object(i["M"])((function(t){return c.showDeleteBtn(t,e.RouteUID)}),["prevent"]),onPointerup:Object(i["M"])((function(t){return c.changeRouterId(e.City,e.RouteName.Zh_tw,e.RouteUID)}),["prevent"])},[Object(i["g"])("div",ae,Object(i["E"])(e.RouteName.Zh_tw),1),Object(i["g"])("div",re,[Object(i["g"])("span",null,Object(i["E"])(e.DepartureStopNameZh),1),Object(i["i"])(r,{icon:["fas","exchange-alt"],class:"mx-2"}),Object(i["g"])("span",null,Object(i["E"])(e.DestinationStopNameZh),1)]),"CollectRoute"!==t.$route.name?(Object(i["u"])(),Object(i["f"])("div",{key:0,class:"col-1 ms-auto",onPointerup:Object(i["M"])((function(t){return c.setCollectRoute(e.RouteUID)}),["prevent","stop"])},[Object(i["i"])(r,{icon:[e.isCollect?"fas":"far","bookmark"],class:"mx-2"},null,8,["icon"])],40,ue)):Object(i["e"])("",!0),"/bus"!==t.$route.path&&c.deleteBtnIsShow===e.RouteUID?(Object(i["u"])(),Object(i["f"])("div",ie,[Object(i["g"])("button",{class:"btn btn-primary rounded-3 h-100 px-4",onPointerup:Object(i["M"])((function(t){return c.removeCollect(e.RouteUID)}),["prevent"])}," 刪除 ",40,se)])):Object(i["e"])("",!0)],42,oe)})),128))])):Object(i["e"])("",!0)}n("7db0"),n("c740"),n("a434"),n("e9c4");var be={setup:function(){var t=Object(bt["b"])(),e=t.state,n=t.commit,c=Object(m["c"])(),o=Object(i["b"])((function(){return e.routes})),a=Object(i["z"])(null),r=function(t,e,n){a.value!==n&&c.push({name:"Arrival",params:{city:t,routeName:e,routeId:n}})},u=0,s=function(t,e){console.log(c.currentRoute.value.path),"/bus"!==c.currentRoute.value.path&&(u?"CollectRoute"===c.currentRoute.value.name&&u-t.offsetX>1?(a.value=e,u=0):u-t.offsetX<0&&(a.value="",u=0):u=t.offsetX)},l=function(t){var e=JSON.parse(localStorage.getItem("collectRoute"))||[],c=o.value.find((function(e){return e.RouteUID===t}));if(console.log(t,c),c.isCollect){var a=e.findIndex((function(e){return e.RouteUID===t}));e.splice(a,1)}else e=[].concat(Object(st["a"])(e),[c]);localStorage.setItem("collectRoute",JSON.stringify(e)),n("getRouteData",o.value)},b=function(t){var e=JSON.parse(localStorage.getItem("collectRoute"))||[],c=e.findIndex((function(e){return e.RouteUID===t}));e.splice(c,1),localStorage.setItem("collectRoute",JSON.stringify(e)),n("getRouteData",JSON.parse(localStorage.getItem("collectRoute")))};return{routes:o,changeRouterId:r,setCollectRoute:l,showDeleteBtn:s,deleteBtnIsShow:a,removeCollect:b}}};n("fbce");const pe=U()(be,[["render",le],["__scopeId","data-v-2b3b2786"]]);var fe=pe,Oe={name:"Bus",components:{BusRoute:fe},setup:function(){var t=Object(bt["b"])(),e=t.state,n=t.dispatch,o=Object(i["b"])((function(){return e.city})),a=Object(i["z"])(null),r=function(){new c["Dropdown"](a.value).hide()},u=Object(i["z"])(!1),s=Object(i["y"])({cityEn:"",cityZh:"",routeName:""}),l=function(t){s.cityEn=t.target.dataset.cityEn,s.cityZh=t.target.dataset.cityZh,s.routeName="",r(),u.value=!0},b=function(t){"BUTTON"===t.target.tagName&&(s.routeName+=t.target.textContent)},p=function(t){var e=s.routeName.length,n=t.target.dataset.clear;switch(n){case"all":s.routeName="";break;default:s.routeName=s.routeName.substring(0,e-1);break}};Object(i["J"])((function(){return s.routeName}),function(){var t=Object(pt["a"])(regeneratorRuntime.mark((function t(e,c){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e||e===c){t.next=3;break}return t.next=3,n("getData",{type:"route",routeName:s.routeName,city:s.cityEn});case 3:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}());var f=Object(i["z"])("true"),O=Object(i["z"])(null),j=function(){f.value=!f.value,Object(i["n"])((function(){O.value.focus()}))},d=Object(i["z"])("true"),m=function(){d.value=!d.value};return Object(i["s"])((function(){a.value.addEventListener("show.bs.dropdown",(function(){u.value=!1}))})),Object(it["a"])(Object(it["a"])({BusCity:o,dropdown:a,closeDropMenu:r,customKeyboard:u},Object(i["F"])(s)),{},{getCityName:l,getRouteName:b,deleteWord:p,keyboard:f,routeNameInput:O,changeKeyboard:j,options:d,changeOptions:m})}};n("3265");const je=U()(Oe,[["render",ne],["__scopeId","data-v-0dc85124"]]);var de=je,me={class:"btn btn-lg bg-white rounded-3 shadow d-flex justify-content-between my-2"},ge={key:0,class:"text-start"},he={class:"fs-6"},ye={class:"align-bottom fs-6"},ve={key:0},Se={key:1},we={class:"text-end"},xe={class:"mt-3"},Re={class:"fs-6 mx-2"},De={key:0,class:"bg-warning text-white px-2 rounded-3 fs-xs"},Ie=["onPointerup"];function Ne(t,e,n,c,o,a){var r=Object(i["C"])("Map"),u=Object(i["C"])("font-awesome-icon");return Object(i["u"])(),Object(i["f"])(i["a"],null,[c.mapIsShow?(Object(i["u"])(),Object(i["d"])(r,{key:0,direction:c.direction,onChangeMapIsShow:c.changeMapIsShow},null,8,["direction","onChangeMapIsShow"])):Object(i["e"])("",!0),Object(i["g"])("article",{class:Object(i["o"])(["arrival container pt-3 position-absolute",{"map-show":c.mapIsShow}])},[Object(i["g"])("div",me,[0!==c.route.length?(Object(i["u"])(),Object(i["f"])("div",ge,[Object(i["g"])("div",he,Object(i["E"])(c.route[0].RouteName.Zh_tw),1),Object(i["g"])("div",ye,[0===c.direction?(Object(i["u"])(),Object(i["f"])("span",ve,"往"+Object(i["E"])(c.route[0].DestinationStopNameZh),1)):(Object(i["u"])(),Object(i["f"])("span",Se,"往"+Object(i["E"])(c.route[0].DepartureStopNameZh),1)),Object(i["g"])("span",{class:"fs-4 p-2",onPointerup:e[0]||(e[0]=function(){return c.changeMapIsShow&&c.changeMapIsShow.apply(c,arguments)})},[Object(i["i"])(u,{icon:["far","map"],class:""})],32)])])):Object(i["e"])("",!0),Object(i["g"])("div",we,[Object(i["g"])("div",{class:"fs-4 p-2",onPointerup:e[1]||(e[1]=Object(i["M"])((function(){return c.changeRouteDirection&&c.changeRouteDirection.apply(c,arguments)}),["stop"]))},[Object(i["i"])(u,{icon:["fas","exchange-alt"],class:"fs-4 ms-2"})],32)])]),Object(i["g"])("section",xe,[0!==c.stops.length?(Object(i["u"])(!0),Object(i["f"])(i["a"],{key:0},Object(i["B"])(c.stops[0].Stops,(function(t){return Object(i["u"])(),Object(i["f"])("div",{key:t.StopUID,class:"d-flex align-items-center my-2"},[(Object(i["u"])(!0),Object(i["f"])(i["a"],null,Object(i["B"])(c.estimateds,(function(e){return Object(i["u"])(),Object(i["f"])(i["a"],{key:e.StopUID},[e.StopUID===t.StopUID?(Object(i["u"])(),Object(i["f"])("span",{key:0,class:Object(i["o"])(["text-white px-3 py-2 rounded-3 btn-sm w-25",e.StopStatus>0?"bg-success":"",Math.floor(e.EstimateTime/60)<1?"bg-danger":"",3>=Math.floor(e.EstimateTime/60)>=1?"bg-warning":"",Math.floor(e.EstimateTime/60)>3?"bg-primary":""])},Object(i["E"])(e.StopStatus>0?"尚未發車":Math.floor(e.EstimateTime/60)>=1?"".concat(Math.floor(e.EstimateTime/60),"分"):"即將進站"),3)):Object(i["e"])("",!0)],64)})),128)),Object(i["g"])("span",Re,Object(i["E"])(t.StopName.Zh_tw),1),(Object(i["u"])(!0),Object(i["f"])(i["a"],null,Object(i["B"])(c.accurateStops,(function(e){return Object(i["u"])(),Object(i["f"])(i["a"],{key:e.StopUID},[e.StopUID===t.StopUID?(Object(i["u"])(),Object(i["f"])("span",De,Object(i["E"])(e.PlateNumb),1)):Object(i["e"])("",!0)],64)})),128)),Object(i["g"])("span",{class:"ms-auto p-2",onPointerup:Object(i["M"])((function(e){return c.setCollectStation(t.StopUID)}),["stop"])},[Object(i["i"])(u,{icon:[t.isCollect?"fas":"far","bookmark"],class:"mx-2 fs-4"},null,8,["icon"])],40,Ie)])})),128)):Object(i["e"])("",!0)])],2)],64)}n("a9e3");var ke={class:"btn btn-lg bg-white border-primary text-primary"};function Ce(t,e,n,c,o,a){var r=Object(i["C"])("l-tile-layer"),u=Object(i["C"])("font-awesome-icon"),s=Object(i["C"])("l-control"),l=Object(i["C"])("l-polyline"),b=Object(i["C"])("l-icon"),p=Object(i["C"])("l-marker"),f=Object(i["C"])("l-map");return Object(i["u"])(),Object(i["d"])(f,{ref:"busMap",class:Object(i["o"])(["Arrival"===t.$route.name?"position-fixed":"position-relative"]),style:{height:"40vh",width:"100%",top:"102px"},zoom:c.zoom,center:c.center,options:{zoomControl:!1},onReady:c.ready},{default:Object(i["K"])((function(){return[Object(i["i"])(r,{url:o.url,attribution:o.attribution},null,8,["url","attribution"]),"Arrival"===t.$route.name?(Object(i["u"])(),Object(i["f"])(i["a"],{key:0},["Arrival"===t.$route.name?(Object(i["u"])(),Object(i["d"])(s,{key:0,position:"bottomright",ref:"control",onPointerup:c.changeMapIsShow},{default:Object(i["K"])((function(){return[Object(i["g"])("button",ke,[Object(i["i"])(u,{icon:["fas","chevron-up"],class:""})])]})),_:1},8,["onPointerup"])):Object(i["e"])("",!0),0!==c.shape.Geometry.coordinates.length?(Object(i["u"])(),Object(i["d"])(l,{key:1,"lat-lngs":c.shape.Geometry.coordinates,color:"#929259",opacity:.45,ref:"routeShape"},null,8,["lat-lngs","opacity"])):Object(i["e"])("",!0),0!==c.stops.length?(Object(i["u"])(!0),Object(i["f"])(i["a"],{key:2},Object(i["B"])(c.stops[0].Stops,(function(t){return Object(i["u"])(),Object(i["d"])(p,{key:t.StopID,"lat-lng":[t.StopPosition.PositionLat,t.StopPosition.PositionLon]},{default:Object(i["K"])((function(){return[Object(i["i"])(b,null,{default:Object(i["K"])((function(){return[Object(i["i"])(u,{icon:["fas","map-pin"],class:"display-6 text-danger"})]})),_:1})]})),_:2},1032,["lat-lng"])})),128)):Object(i["e"])("",!0),0!==c.RealTimeByFrequency.length?(Object(i["u"])(!0),Object(i["f"])(i["a"],{key:3},Object(i["B"])(c.RealTimeByFrequency,(function(t){return Object(i["u"])(),Object(i["d"])(p,{key:t.PlateNumb,"lat-lng":[t.BusPosition.PositionLat,t.BusPosition.PositionLon]},{default:Object(i["K"])((function(){return[Object(i["i"])(b,null,{default:Object(i["K"])((function(){return[Object(i["i"])(u,{icon:["fas","bus"],class:"text-primary display-5"})]})),_:1})]})),_:2},1032,["lat-lng"])})),128)):Object(i["e"])("",!0)],64)):Object(i["e"])("",!0),"NearBus"===t.$route.name?(Object(i["u"])(),Object(i["f"])(i["a"],{key:1},[Object(i["i"])(p,{"lat-lng":c.center},{default:Object(i["K"])((function(){return[Object(i["i"])(b,null,{default:Object(i["K"])((function(){return[Object(i["i"])(u,{icon:["fas","map-marker-alt"],class:"text-primary display-5"})]})),_:1})]})),_:1},8,["lat-lng"]),0!==c.nearBusStop.length?(Object(i["u"])(!0),Object(i["f"])(i["a"],{key:0},Object(i["B"])(c.nearBusStop,(function(t){return Object(i["u"])(),Object(i["d"])(p,{key:t.StationUID,"lat-lng":[t.StationPosition.PositionLat,t.StationPosition.PositionLon]},{default:Object(i["K"])((function(){return[Object(i["i"])(b,null,{default:Object(i["K"])((function(){return[Object(i["i"])(u,{icon:["fas","map-pin"],class:Object(i["o"])(["display-6",n.openStationUid===t.StationUID?"text-danger":"text-success"])},null,8,["class"])]})),_:2},1024)]})),_:2},1032,["lat-lng"])})),128)):Object(i["e"])("",!0)],64)):Object(i["e"])("",!0)]})),_:1},8,["class","zoom","center","onReady"])}var Be=n("5afd"),Ue={name:"Map",components:{LMap:Be["c"],LTileLayer:Be["f"],LPolyline:Be["e"],LControl:Be["a"],LMarker:Be["d"],LIcon:Be["b"]},props:{direction:Number,openStationUid:String},setup:function(t,e){var n=e.emit;console.log("Map");var c,o=Object(bt["b"])(),a=o.state,r=o.getters,u=o.dispatch,s=Object(m["c"])(),l=s.currentRoute,b=Object(i["z"])(null),p=Object(i["z"])([25,121]),f=Object(i["z"])(18),O=Object(i["z"])(null),j=l.value.params,d=j.city,g=j.routeName,h=j.routeId,y=function(){"Arrival"===l.value.name?(u("getData",{type:"realTimeByFrequency",city:d,routeName:g,routeId:h}),u("getData",{type:"shape",city:d,routeName:g,routeId:h}),u("getData",{type:"stop",routeName:g,city:d,routeId:h}),c=setInterval((function(){u("getData",{type:"realTimeByFrequency",city:d,routeName:g,routeId:h})}),3e4)):"NearBus"===l.value.name&&yt(4500)},v=function(){y()},S=Object(i["z"])(null),w=Object(i["b"])((function(){return a.selectedRoute.shape})),x=Object(i["b"])((function(){return r.filterStopRoute(t.direction)})),R=Object(i["b"])((function(){return r.filterRealTimeByFrequency(t.direction)}));Object(i["J"])((function(){return w.value.Geometry.coordinates}),(function(t){if(0!==t.length){var e=t[0][0],n=t[0][1],c=0,o=0;t.forEach((function(t){e=t[0]<e?t[0]:e,n=t[1]<n?t[1]:n,c=t[0]>c?t[0]:c,o=t[1]>o?t[1]:o})),b.value.leafletObject.flyToBounds([[e,n],[c,o]])}}));var D=function(){n("changeMapIsShow")},I=Object(i["b"])((function(){return a.NearLocationBus})),N=Object(i["b"])((function(){return a.location}));return Object(i["J"])(N,(function(t){console.log(t);var e=t.lat,n=t.lon;p.value=[e,n],f.value=13,b.value.leafletObject.flyTo([e,n],f.value)})),Object(i["t"])((function(){clearInterval(c)})),{busMap:b,ready:v,center:p,zoom:f,control:O,routeShape:S,shape:w,stops:x,RealTimeByFrequency:R,changeMapIsShow:D,nearBusStop:I}},data:function(){return{url:"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'}}};const Ee=U()(Ue,[["render",Ce]]);var _e=Ee,Me={name:"Arrival",components:{Map:_e},setup:function(){var t=Object(bt["b"])(),e=t.state,n=t.getters,c=t.dispatch,o=t.commit,a=Object(m["c"])(),r=a.currentRoute,u=Object(i["z"])(!1),s=r.value.params,l=s.city,b=s.routeName,p=s.routeId,f=function(){c("getData",{type:"route",routeName:b,city:l,routeId:p}),c("getData",{type:"stop",routeName:b,city:l,routeId:p}),c("getData",{type:"realTimeNearStop",routeName:b,city:l,routeId:p}),c("getData",{type:"estimated",routeName:b,city:l,routeId:p})};f();var O=setInterval((function(){f()}),3e4),j=Object(i["z"])(0),d=function(){j.value=Number(!j.value)},g=Object(i["b"])((function(){return n.filterRoute(p)})),h=Object(i["b"])((function(){return n.filterStopRoute(j.value)})),y=Object(i["b"])((function(){return n.filterRealTimeNearStop(j.value)})),v=Object(i["b"])((function(){return n.filterEstimatedBus(j.value)})),S=function(){u.value=!u.value},w=function(t){var n=JSON.parse(localStorage.getItem("collectStation"))||[],c=h.value[0].Stops.find((function(e){return e.StopUID===t}));if(c.isCollect){var a=n.findIndex((function(e){return e.StopUID===t}));n.splice(a,1)}else n=[].concat(Object(st["a"])(n),[{route:g.value[0],stop:c}]);localStorage.setItem("collectStation",JSON.stringify(n)),o("getStopData",e.selectedRoute.Stops)};return Object(i["t"])((function(){clearInterval(O)})),{mapIsShow:u,direction:j,route:g,changeRouteDirection:d,stops:h,accurateStops:y,estimateds:v,changeMapIsShow:S,setCollectStation:w}}};n("529e");const Te=U()(Me,[["render",Ne],["__scopeId","data-v-4066d4e1"]]);var Pe=Te,Le={class:"container position-relative",style:{top:"120px","padding-bottom":"180px"}},Ze={key:0,class:"accordion my-2"},Je={class:"accordion-header"},$e=["data-bs-target","aria-controls","onClick"],Ke={class:"row w-75 g-1 align-items-center"},ze={class:"col-6"},qe={class:"col-6 d-flex flex-wrap"},Fe=["id"],Ae={key:0,class:"container px-3 py-1"},Ge={class:"col-3 text-start"},He={class:"col-7"},Xe={class:"m-1"},We={class:"col-2 text-end p-2"};function Ve(t,e,n,c,o,a){var r=Object(i["C"])("Map"),u=Object(i["C"])("font-awesome-icon"),s=Object(i["C"])("router-link");return Object(i["u"])(),Object(i["f"])(i["a"],null,[Object(i["i"])(r,{"open-station-uid":c.open},null,8,["open-station-uid"]),Object(i["g"])("article",Le,[0!==c.nearBusStop.length?(Object(i["u"])(),Object(i["f"])("div",Ze,[(Object(i["u"])(!0),Object(i["f"])(i["a"],null,Object(i["B"])(c.nearBusStop,(function(t){return Object(i["u"])(),Object(i["f"])("div",{class:"accordion-item my-3 border-0",key:t.StationUID},[Object(i["g"])("h2",Je,[Object(i["g"])("button",{class:Object(i["o"])(["accordion-button  px-3",c.open===t.StationUID?"":"collapsed"]),type:"button","data-bs-toggle":"collapse","data-bs-target":"#".concat(t.StationUID),"aria-expanded":"false","aria-controls":t.StationUID,onClick:Object(i["M"])((function(e){return c.changeOpenId(t.StationUID)}),["prevent"])},[Object(i["g"])("div",Ke,[Object(i["g"])("div",ze,Object(i["E"])(t.StationName.Zh_tw),1),Object(i["g"])("div",qe,[(Object(i["u"])(!0),Object(i["f"])(i["a"],null,Object(i["B"])(t.Stops,(function(t){return Object(i["u"])(),Object(i["f"])("span",{class:"m-1",key:t.RouteUID},Object(i["E"])(t.RouteName.Zh_tw),1)})),128))])])],10,$e)]),Object(i["g"])("div",{id:t.StationUID,class:Object(i["o"])(["accordion-collapse collapse",c.open===t.StationUID?"show":""]),"aria-labelledby":"headingOne"},[0!==c.stationRoute.length?(Object(i["u"])(),Object(i["f"])("div",Ae,[(Object(i["u"])(!0),Object(i["f"])(i["a"],null,Object(i["B"])(c.stationRoute,(function(t){return Object(i["u"])(),Object(i["d"])(s,{to:{name:"Arrival",params:{city:c.city,routeName:t.RouteName.Zh_tw,routeId:t.RouteUID}},class:"row g-2 align-items-center my-2 text-decoration-none",key:t.RouteUID},{default:Object(i["K"])((function(){return[Object(i["g"])("div",Ge,Object(i["E"])(t.RouteName.Zh_tw),1),Object(i["g"])("div",He,[Object(i["g"])("span",Xe,"往"+Object(i["E"])(t.DestinationStopNameZh),1)]),Object(i["g"])("span",We,[Object(i["i"])(u,{icon:["far","bookmark"],class:"fs-4"})])]})),_:2},1032,["to"])})),128))])):Object(i["e"])("",!0)],10,Fe)])})),128))])):Object(i["e"])("",!0)])],64)}var Ye={name:"NearBus",components:{Map:_e},setup:function(){var t=Object(bt["b"])(),e=t.state,n=t.dispatch,c=Object(i["z"])(null),o=Object(i["b"])((function(){return e.NearLocationBus})),a=Object(i["z"])([]),r=Object(i["b"])((function(){return e.location.city})),u=function(t){c.value=t};return Object(i["J"])(c,(function(t,e){if(t&&t!==e){a.value=[];var c=o.value.find((function(e){return e.StationUID===t}));c.Stops.forEach(function(){var t=Object(pt["a"])(regeneratorRuntime.mark((function t(e){var c,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return c=e,t.next=3,n("getDestinationStop",{type:"route",city:r.value,RouteName:c.RouteName.Zh_tw,RouteUID:c.RouteUID});case 3:o=t.sent,a.value=[].concat(Object(st["a"])(a.value),[Object(it["a"])(Object(it["a"])({},c),{},{DestinationStopNameZh:o[0].DestinationStopNameZh})]);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}})),{open:c,city:r,nearBusStop:o,changeOpenId:u,stationRoute:a}}};const Qe=U()(Ye,[["render",Ve]]);var tn=Qe,en={class:"container"},nn={class:"row g-0 shadow"},cn={class:"col-6 d-grid bg-white"},on=Object(i["h"])("公車站"),an={class:"col-6 d-grid"},rn=Object(i["h"])("公車路線");function un(t,e,n,c,o,a){var r=Object(i["C"])("router-link"),u=Object(i["C"])("router-view");return Object(i["u"])(),Object(i["f"])("div",en,[Object(i["g"])("div",nn,[Object(i["g"])("div",cn,[Object(i["i"])(r,{to:"/collect/station",class:Object(i["o"])(["btn rounded-3","CollectStation"===t.$route.name?"btn-primary":"bg-white"])},{default:Object(i["K"])((function(){return[on]})),_:1},8,["class"])]),Object(i["g"])("div",an,[Object(i["i"])(r,{to:"/collect/route",class:Object(i["o"])(["btn rounded-3","CollectRoute"===t.$route.name?"btn-primary":"bg-white"])},{default:Object(i["K"])((function(){return[rn]})),_:1},8,["class"])])]),Object(i["i"])(u,{class:"my-2"})])}var sn={name:"Collect",setup:function(){var t=Object(bt["b"])(),e=t.commit;e("getRouteData",JSON.parse(localStorage.getItem("collectRoute"))||[])}};n("6f70");const ln=U()(sn,[["render",un],["__scopeId","data-v-6784b0b2"]]);var bn=ln,pn=["onPointermove"],fn={class:"col-auto text-start"},On={class:"m-0"},jn={class:"text-success fs-xs"},dn={class:"col-auto text-start"},mn={class:"m-0"},gn={key:0,class:"col-auto text-end"},hn={key:0,class:"col-auto p-0 text-nowrap"},yn=["onPointerup"];function vn(t,e,n,c,o,a){return Object(i["u"])(!0),Object(i["f"])(i["a"],null,Object(i["B"])(c.stations,(function(t){return Object(i["u"])(),Object(i["f"])("div",{class:Object(i["o"])(["row gx-2 justify-content-between align-items-center my-3 bg-white py-2 px-1 rounded-3",c.deleteBtnIsShow===t.stop.StopUID?"moveRight":""]),key:t.stop.StopUID,onPointermove:Object(i["M"])((function(e){return c.showDeleteBtn(e,t.stop.StopUID)}),["prevent"])},[Object(i["g"])("div",fn,[Object(i["g"])("h5",On,Object(i["E"])(t.route.RouteName.Zh_tw),1),Object(i["g"])("div",jn,"往"+Object(i["E"])(t.route.DestinationStopNameZh),1)]),Object(i["g"])("div",dn,[Object(i["g"])("h5",mn,Object(i["E"])(t.stop.StopName.Zh_tw),1)]),(Object(i["u"])(!0),Object(i["f"])(i["a"],null,Object(i["B"])(c.estimateTime,(function(e){return Object(i["u"])(),Object(i["f"])(i["a"],{key:e.StopUID},[t.stop.StopUID===e.StopUID?(Object(i["u"])(),Object(i["f"])("div",gn,Object(i["E"])(e.EstimateTime?"".concat(Math.ceil(e.EstimateTime/60),"分"):"未提供預估抵達時間"),1)):Object(i["e"])("",!0)],64)})),128)),c.deleteBtnIsShow===t.stop.StopUID?(Object(i["u"])(),Object(i["f"])("div",hn,[Object(i["g"])("button",{class:"btn btn-primary rounded-3 h-100 px-4",onPointerup:Object(i["M"])((function(e){return c.removeCollect(t.stop.StopUID)}),["prevent"])}," 刪除 ",40,yn)])):Object(i["e"])("",!0)],42,pn)})),128)}var Sn={name:"CollectStation",setup:function(){var t=Object(bt["b"])(),e=t.state,n=t.getters,c=Object(i["z"])(JSON.parse(localStorage.getItem("collectStation"))||[]),o=Object(i["z"])([]);Object(i["J"])(c,(function(t,c){if(0!==t.length&&t!==c){var a=e.api.Estimated_url;t.forEach(function(){var t=Object(pt["a"])(regeneratorRuntime.mark((function t(e){var c,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,fetch("".concat(a).concat(e.route.City,"/").concat(e.route.RouteName.Zh_tw,"?$filter=RouteUID eq '").concat(e.route.RouteUID,"' and contains(StopUID, '").concat(e.stop.StopUID,"') and Direction eq '去程'&$top=1&$format=JSON"),n.headers);case 2:return c=t.sent,t.next=5,c.json();case 5:r=t.sent,o.value=[].concat(Object(st["a"])(o.value),Object(st["a"])(r));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}),{immediate:!0});var a=Object(i["z"])(null),r=0,u=function(t,e){r?r-t.offsetX>1?(a.value=e,r=0):r-t.offsetX<0&&(a.value="",r=0):r=t.offsetX},s=function(t){var e=JSON.parse(localStorage.getItem("collectStation"))||[],n=e.findIndex((function(e){return e.stop.StopUID===t}));e.splice(n,1),localStorage.setItem("collectStation",JSON.stringify(e)),c.value=JSON.parse(localStorage.getItem("collectStation"))};return{stations:c,estimateTime:o,deleteBtnIsShow:a,showDeleteBtn:u,removeCollect:s}}};n("66fb");const wn=U()(Sn,[["render",vn],["__scopeId","data-v-32026cae"]]);var xn=wn;function Rn(t,e,n,c,o,a){var r=Object(i["C"])("BusRoute");return Object(i["u"])(),Object(i["d"])(r)}var Dn={name:"Bus",components:{BusRoute:fe}};const In=U()(Dn,[["render",Rn]]);var Nn=In,kn=[{path:"/",name:"Home",component:wt},{path:"/bus",name:"Bus",component:de},{path:"/bus/:city/:routeName/:routeId",name:"Arrival",component:Pe},{path:"/nearBus",name:"NearBus",component:tn},{path:"/collect",name:"Collect",component:bn,children:[{path:"station",name:"CollectStation",component:xn},{path:"route",name:"CollectRoute",component:Nn}]}],Cn=Object(m["a"])({history:Object(m["b"])(),routes:kn}),Bn=Cn;o["c"].add(a["c"],a["k"],a["h"],r["b"],a["i"],a["b"],a["f"],a["e"],a["g"],a["a"],r["a"],a["d"],a["j"]),Object(i["c"])(P).use(c).use(ht).use(Bn).component("font-awesome-icon",u["a"]).mount("#app")},"66fb":function(t,e,n){"use strict";n("4724")},6800:function(t,e,n){},"6f70":function(t,e,n){"use strict";n("c4c8")},"9b19":function(t,e,n){t.exports=n.p+"img/logo.44a24970.svg"},b107:function(t,e,n){},c4c8:function(t,e,n){},cb3a:function(t,e,n){},e00c:function(t,e,n){},fbce:function(t,e,n){"use strict";n("2918")}});
//# sourceMappingURL=app.3b166333.js.map